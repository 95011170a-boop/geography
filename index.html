<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è±ªè¯æŠ½ç‰Œé»æ•¸ç´¯ç©éŠæˆ²</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ä½¿ç”¨ Inter å­—é«” -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* èª¿æ•´ç‚ºæ›´æŸ”å’Œã€ä¸é›œäº‚çš„èƒŒæ™¯è‰² */
            background: linear-gradient(135deg, #FEE140 0%, #FA709A 100%); /* è¼ƒæŸ”å’Œçš„è‰²å½©èƒŒæ™¯ (é‡‘æ©™åˆ°ç²‰ç´…) */
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            overflow: hidden; /* é˜²æ­¢æ»¾å‹•æ¢å½±éŸ¿ Modal */
        }
        .game-card {
            background-color: #ffffff;
            border: 8px solid #FFD700; /* è±ªè¯é‚Šæ¡† */
        }
        /* å®šç¾©æŒ‰éˆ•æ¨£å¼ */
        .btn-draw {
            @apply w-full px-8 py-4 text-2xl bg-red-600 text-white font-extrabold rounded-2xl shadow-[0_8px_0_0_#9A3200] hover:bg-red-700 transition duration-150 transform hover:translate-y-1 hover:shadow-[0_4px_0_0_#9A3200] focus:outline-none focus:ring-4 focus:ring-red-300;
        }
        /* é»æ•¸é¡¯ç¤ºæ¨£å¼ */
        .points-display {
            @apply text-4xl font-extrabold text-white p-4 rounded-xl shadow-lg border-4 border-yellow-300 bg-red-500;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        /* æŠ½ç‰Œçµæœå¡ç‰‡ */
        .result-box {
            @apply p-6 rounded-xl shadow-2xl transition-all duration-500 min-h-[8rem] flex flex-col items-center justify-center space-y-2;
        }
        
        /* ç‰Œé¢é¡¯ç¤º */
        .card-display {
            @apply w-24 h-36 border-4 rounded-xl flex flex-col items-center justify-center shadow-xl bg-white text-6xl font-black transition-all duration-300 ease-in-out;
        }
        
        /* Modal æ¨£å¼ */
        .modal {
            background-color: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: linear-gradient(to top, #4F46E5, #8B5CF6); /* ç´«è—è‰²èª¿ */
            border: 6px solid #FFD700;
            animation: phoneSlide 0.5s ease-out;
        }
        
        /* ä¸­ç Modal æ¨£å¼ */
        #winModal .modal-content {
            background: linear-gradient(to top, #FFD700, #FFA500); /* äº®é‡‘è‰²èª¿ */
            border: 8px solid #FF4500;
            animation: pulse 1s infinite alternate;
            box-shadow: 0 0 50px rgba(255, 69, 0, 0.9);
        }
        
        @keyframes phoneSlide {
            from { transform: translateY(100vh) scale(0.5); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }
        @keyframes pulse {
            from { transform: scale(1); box-shadow: 0 0 50px rgba(255, 69, 0, 0.9); }
            to { transform: scale(1.05); box-shadow: 0 0 70px rgba(255, 215, 0, 0.9); }
        }
        
        /* åˆ®åˆ®æ¨‚ Canvas */
        #scratchCanvas {
            touch-action: none; /* ç¦ç”¨ç€è¦½å™¨é»˜èªçš„è§¸æ§è¡Œç‚º */
        }
    </style>
</head>
<body>

    <div class="w-full max-w-lg game-card rounded-3xl shadow-2xl p-6 md:p-10 space-y-8">

        <h1 class="text-4xl font-extrabold text-center text-gray-800 pb-4 border-b-4 border-red-500">
            ğŸƒ å¹¸é‹æŠ½ç‰Œå¤§çè³½ ğŸ’°
        </h1>
        
        <!-- é»æ•¸ç´¯ç©å€å¡Š -->
        <div class="flex flex-col items-center space-y-4">
            <p class="text-xl font-semibold text-gray-700">é»æ•¸ç´¯ç© <span class="font-bold text-red-600">(ç›®æ¨™ï¼š2 é»)</span></p>
            <div id="currentPointsDisplay" class="points-display">
                0 é»
            </div>
            <p class="text-sm text-gray-500">ï¼ˆæŠ½åˆ° A~9 ç‰Œå¯ç²å¾— 1 é»ï¼‰</p>
        </div>

        <!-- å–®æ¬¡æŠ½ç‰Œçµæœé¡¯ç¤º -->
        <div id="drawResultBox" class="result-box bg-gray-100 text-gray-700 text-xl font-medium">
            é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼ŒæŠ½ä¸€å¼µå¹¸é‹å¡ç‰Œï¼
        </div>

        <!-- æŠ½ç‰ŒæŒ‰éˆ• -->
        <button id="drawButton" class="btn-draw" onclick="drawSingleCard()">
            ç«‹å³æŠ½ç‰Œï¼ ğŸ‰
        </button>

    </div>

    <!-- 1. æ¯”å¤§å° Modal -->
    <div id="comparisonModal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden z-50">
        <div class="modal-content w-full max-w-md p-8 rounded-3xl shadow-2xl space-y-6">
            <h2 class="text-3xl font-extrabold text-center text-yellow-300">
                ğŸ“± é»æ•¸ç›®æ¨™é”æˆï¼åŠ ç¢¼æŒ‘æˆ°ï¼ ğŸ“±
            </h2>
            <p class="text-xl text-center font-semibold text-white">
                æ‚¨å·²ç´¯ç© <span id="modalPoints" class="text-yellow-300 font-extrabold">2</span> é»ï¼
                <br>
                è´äº†æ¯”å¤§å°ï¼Œåˆ®åˆ®æ¨‚å¤§çç­‰ä½ ï¼
            </p>
            
            <!-- æ¯”å¤§å°é¡¯ç¤º -->
            <div class="flex justify-around items-center space-x-4 p-4 rounded-xl bg-white/10 shadow-inner">
                <div class="text-center">
                    <span class="block font-semibold mb-2 text-lg text-yellow-300">æ‚¨çš„ç‰Œ</span>
                    <div id="playerCard" class="card-display border-yellow-300 text-red-600">?</div>
                </div>
                <span class="text-6xl font-black text-white">VS</span>
                <div class="text-center">
                    <span class="block font-semibold mb-2 text-lg text-yellow-300">é›»è…¦çš„ç‰Œ</span>
                    <div id="computerCard" class="card-display border-yellow-300 text-blue-600">?</div>
                </div>
            </div>

            <div id="comparisonResultText" class="text-center text-xl font-bold p-3 rounded-lg bg-white text-gray-800 shadow-inner">
                é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œæ±ºå®šå‹è² ï¼
            </div>

            <button id="startCompareButton" class="w-full px-6 py-3 bg-green-500 text-white font-extrabold rounded-xl shadow-[0_5px_0_0_#1E8449] hover:bg-green-600 transition duration-150 transform hover:translate-y-0.5" onclick="startComparison()">
                é–‹å§‹æ¯”å¤§å°ï¼
            </button>
            <button id="comparisonCloseButton" class="w-full px-6 py-3 bg-gray-500 text-white font-bold rounded-xl hover:bg-gray-600 hidden" onclick="closeAllModals('æ¯”å¤§å°æŒ‘æˆ°å·²å®Œæˆã€‚')">
                ç¹¼çºŒéŠæˆ²
            </button>
        </div>
    </div>
    
    <!-- 2. åˆ®åˆ®æ¨‚ Modal (äº’å‹•å¼) -->
    <div id="scratchModal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden z-50">
        <div class="modal-content w-full max-w-md p-8 rounded-3xl shadow-2xl space-y-6">
            <h2 class="text-3xl font-extrabold text-center text-yellow-300">
                âœ¨ æ­å–œç²å‹ï¼è«‹åˆ®é–‹çåˆ¸ âœ¨
            </h2>
            <p class="text-lg text-center font-semibold text-white">
                åˆ®é–‹å¡—å±¤ï¼Œçœ‹çœ‹æ‚¨ä¸­äº†ä»€éº¼å¤§çï¼
            </p>
            
            <div class="bg-white/10 p-2 rounded-xl shadow-inner">
                <div class="relative w-full aspect-video rounded-lg overflow-hidden">
                    <!-- é¡¯ç¤ºçå‹µçµæœçš„åº•å±¤ -->
                    <div id="prizeDisplay" class="absolute inset-0 flex items-center justify-center text-center p-4">
                        <span class="text-4xl font-black text-red-700">åˆ®é–‹ä¸­...</span>
                    </div>
                    <!-- åˆ®åˆ®æ¨‚ Canvas è¦†è“‹å±¤ -->
                    <canvas id="scratchCanvas" class="absolute inset-0"></canvas>
                </div>
            </div>

            <button id="scratchCloseButton" class="w-full px-6 py-3 bg-gray-500 text-white font-bold rounded-xl hover:bg-gray-600 hidden" onclick="closeAllModals('åˆ®åˆ®æ¨‚æŒ‘æˆ°å·²å®Œæˆã€‚')">
                é—œé–‰çåˆ¸ï¼Œç¹¼çºŒéŠæˆ²
            </button>
        </div>
    </div>
    
    <!-- 3. è±ªè¯ä¸­ç Modal (è¦–è¦ºæ…¶ç¥) -->
    <div id="winModal" class="modal fixed inset-0 flex items-center justify-center p-4 hidden z-50">
        <div class="modal-content w-full max-w-lg p-12 rounded-3xl shadow-2xl space-y-8 text-center">
            <h2 class="text-6xl font-black text-red-700">
                ğŸ‰ æ­å–œä¸­å¤§ç ğŸ‰
            </h2>
            <p class="text-3xl font-extrabold text-white" id="winPrizeText">
                æ‚¨ç²å¾—äº†...
            </p>
            
            <div class="p-4 bg-white/30 rounded-xl">
                <p class="text-7xl font-black text-red-600 animate-bounce" id="winAmount">$60,000</p>
            </div>
            
            <button class="w-full px-6 py-3 bg-red-600 text-white font-extrabold rounded-xl shadow-[0_5px_0_0_#9A3200] hover:bg-red-700 transition" onclick="closeAllModals('ä¸­å¤§çï¼éŠæˆ²çœŸå¥½ç©ï¼')">
                å¤ªæ£’äº†ï¼é ˜çå»ï¼
            </button>
        </div>
    </div>
    
    <script>
        // DOM å…ƒç´ ç²å–
        const DOM = {
            drawButton: document.getElementById('drawButton'),
            drawResultBox: document.getElementById('drawResultBox'),
            currentPointsDisplay: document.getElementById('currentPointsDisplay'),
            
            // 1. Comparison Modal
            comparisonModal: document.getElementById('comparisonModal'),
            compModalContent: document.querySelector('#comparisonModal > div'),
            modalPoints: document.getElementById('modalPoints'),
            playerCard: document.getElementById('playerCard'),
            computerCard: document.getElementById('computerCard'),
            comparisonResultText: document.getElementById('comparisonResultText'),
            startCompareButton: document.getElementById('startCompareButton'),
            comparisonCloseButton: document.getElementById('comparisonCloseButton'),

            // 2. Scratch Modal
            scratchModal: document.getElementById('scratchModal'),
            prizeDisplay: document.getElementById('prizeDisplay'),
            scratchCanvas: document.getElementById('scratchCanvas'),
            scratchCloseButton: document.getElementById('scratchCloseButton'),
            
            // 3. Win Modal
            winModal: document.getElementById('winModal'),
            winPrizeText: document.getElementById('winPrizeText'),
            winAmount: document.getElementById('winAmount'),
        };

        // éŠæˆ²ç‹€æ…‹è®Šæ•¸
        const POINT_GOAL = 2; // é»æ•¸ç›®æ¨™ (å·²å¾ 5 é»ä¿®æ”¹ç‚º 2 é»)
        let currentPoints = 0;
        let isDrawing = false; // é˜²æ­¢é‡è¤‡é»æ“Š
        let prizeWon = null; // å„²å­˜åˆ®åˆ®æ¨‚çµæœ

        // Canvas åˆ®åˆ®æ¨‚ç‹€æ…‹
        let ctx, isScratching = false;
        const SCRATCH_THRESHOLD = 0.5; // 50% çš„å€åŸŸè¢«åˆ®é–‹å³è¦–ç‚ºå®Œæˆ

        // ç‰Œé¢æ•¸å€¼å°æ‡‰ (A æœ€å¤§)
        const CARD_RANKS = {
            14: { name: 'A', value: 14 },
            13: { name: 'K', value: 13 },
            12: { name: 'Q', value: 12 },
            11: { name: 'J', value: 11 },
            10: { name: '10', value: 10 },
            9: { name: '9', value: 9 },
            8: { name: '8', value: 8 },
            7: { name: '7', value: 7 },
            6: { name: '6', value: 6 },
            5: { name: '5', value: 5 },
            4: { name: '4', value: 4 },
            3: { name: '3', value: 3 },
            2: { name: '2', value: 2 }
        };
        
        // ç‰Œé¢æ¬Šé‡å®šç¾© (åŒä¸Šï¼Œ52å¼µç‰Œçµ„)
        const deck = [14, 14, 14, 14, 12, 12, 12, 12, 11, 11, 11, 11, 10, 10, 10, 10, 13, 13, 13, 13];
        for (let rank = 2; rank <= 9; rank++) { for (let i = 0; i < 4; i++) deck.push(rank); }

        // åˆ®åˆ®æ¨‚çå‹µæ©Ÿç‡ (ç¸½å’Œéœ€ç‚º 100%)
        const SCRATCH_PRIZES = [
            { name: 'ğŸ¥‡ ä¸€ç­‰ç ($60,000)', prob: 0.1, color: 'bg-red-600', isBigWin: true, amount: '60,000' }, 
            { name: 'ğŸ¥ˆ äºŒç­‰ç ($40,000)', prob: 0.2, color: 'bg-orange-500', isBigWin: true, amount: '40,000' },
            { name: 'ğŸ¥‰ ä¸‰ç­‰ç (å‡ºåœ‹ä½å®¿ç¦®åˆ¸)', prob: 0.7, color: 'bg-yellow-500', isBigWin: true, amount: 'ç¦®åˆ¸' },
            { name: 'ğŸ… å››ç­‰ç ($1,000)', prob: 10.0, color: 'bg-green-500', isBigWin: false },
            { name: 'ğŸ’” éŠ˜è¬æƒ é¡§', prob: 89.0, color: 'bg-gray-300', isBigWin: false }
        ];

        // --- æ ¸å¿ƒéŠæˆ²æµç¨‹å‡½æ•¸ ---

        /**
         * é—œé–‰æ‰€æœ‰ Modalï¼Œä¸¦é‡ç½®ä¸»éŠæˆ²ç‹€æ…‹
         * Closes all modals and resets the main game state.
         */
        window.closeAllModals = function(message) {
            // é—œé–‰æ‰€æœ‰ Modal
            DOM.comparisonModal.classList.add('hidden');
            DOM.scratchModal.classList.add('hidden');
            DOM.winModal.classList.add('hidden');
            
            // é‡æ–°å•Ÿç”¨ä¸»éŠæˆ²æŒ‰éˆ•
            DOM.drawButton.disabled = false;
            
            // æ›´æ–°é»æ•¸é¡¯ç¤º
            updatePointsDisplay();
            
            // æ›´æ–°ä¸»ç•«é¢çš„çµæœæç¤º
            DOM.drawResultBox.className = 'result-box bg-yellow-100 text-yellow-800 text-lg font-bold';
            DOM.drawResultBox.innerHTML = message + '<br>é»æ•¸å·²é‡ç½®ï¼Œè«‹ç¹¼çºŒæŠ½ç‰Œã€‚';
        }


        /**
         * æ›´æ–°é»æ•¸é¡¯ç¤ºä¸¦æª¢æŸ¥æ˜¯å¦é”æ¨™
         * Updates the point display and checks if the goal has been reached.
         */
        function updatePointsDisplay() {
            DOM.currentPointsDisplay.textContent = `${currentPoints} é»`;
            if (currentPoints >= POINT_GOAL) {
                DOM.modalPoints.textContent = currentPoints;
                launchComparisonModal();
            }
        }

        /**
         * åŸ·è¡Œä¸€æ¬¡æŠ½ç‰Œæ¨¡æ“¬
         * Executes a single card draw simulation.
         */
        window.drawSingleCard = function() {
            if (isDrawing || currentPoints >= POINT_GOAL) {
                DOM.drawResultBox.className = 'result-box bg-yellow-100 text-yellow-800 text-lg font-bold';
                DOM.drawResultBox.innerHTML = currentPoints >= POINT_GOAL ? 'è«‹å…ˆå®Œæˆæ¯”å¤§å°éŠæˆ²ï¼' : 'è«‹ç¨å€™...';
                return;
            }
            isDrawing = true;
            
            // æ¨¡æ“¬æŠ½ç‰Œå‹•ç•«å»¶é²
            DOM.drawResultBox.innerHTML = '<span class="text-3xl font-extrabold text-orange-500">æ­£åœ¨æŠ½ç‰Œ...</span>';

            setTimeout(() => {
                const randomIndex = Math.floor(Math.random() * deck.length);
                const cardValue = deck[randomIndex];
                const cardData = CARD_RANKS[cardValue];

                let resultHTML = '';
                
                // æ ¹æ“šç‰Œé¢é¡å‹çµ¦äºˆçå‹µ
                if ([12, 11].includes(cardValue)) { // Q/J (çå‹µç‰Œ)
                    const prizeName = cardValue === 12 ? 'éº¥ç•¶å‹å¥—é¤' : 'ç¥ç§˜ç¦®ç‰©';
                    const color = cardValue === 12 ? 'red' : 'purple';
                    // Note: 'purple' is not a default Tailwind color, ensuring 'red' or 'blue' is used for consistency.
                    const colorClass = cardValue === 12 ? 'red' : 'indigo'; 

                    resultHTML = `
                        <span class="text-6xl text-${colorClass}-600 font-extrabold">${cardData.name}</span>
                        <p class="text-2xl font-bold text-${colorClass}-800">ğŸ‰ æ­å–œï¼ç²å¾— ${prizeName}ï¼</p>
                    `;
                    DOM.drawResultBox.className = `result-box bg-${colorClass}-100 border-4 border-${colorClass}-500`;
                } else if ([14, 2, 3, 4, 5, 6, 7, 8, 9].includes(cardValue)) { // A~9 (é»æ•¸ç‰Œ)
                    const text = cardValue === 14 ? 'æ°´æœä¸€ç›’' : 'ç²å¾—';
                    const icon = cardValue === 14 ? 'ğŸ' : 'âœ…';
                    resultHTML = `
                        <span class="text-6xl text-blue-600 font-extrabold">${cardData.name}</span>
                        <p class="text-xl font-bold text-green-800">${icon} ${text}ï¼</p>
                        <p class="text-2xl font-bold text-blue-800">+ 1 é»</p>
                    `;
                    DOM.drawResultBox.className = 'result-box bg-blue-100 border-4 border-blue-500';
                    currentPoints += 1;
                } else { // 10, K (æœªä¸­ç)
                    resultHTML = `
                        <span class="text-6xl text-gray-400 font-extrabold">${cardData.name}</span>
                        <p class="text-xl font-bold text-gray-600">å¾ˆéºæ†¾ï¼Œæœ¬æ¬¡æœªä¸­çã€‚</p>
                    `;
                    DOM.drawResultBox.className = 'result-box bg-gray-100 border-4 border-gray-300';
                }
                
                DOM.drawResultBox.innerHTML = resultHTML;
                isDrawing = false;
                updatePointsDisplay();
            }, 800); // æ¨¡æ“¬æŠ½ç‰Œå»¶é²
        }
        
        // --- é»æ•¸é”æ¨™åŠæ¯”å¤§å°éŠæˆ²é‚è¼¯ ---

        /**
         * é¡¯ç¤ºæ¯”å¤§å°éŠæˆ²çš„ Modalã€‚
         * Displays the card comparison modal.
         */
        function launchComparisonModal() {
            DOM.comparisonModal.classList.remove('hidden');
            DOM.compModalContent.classList.remove('scale-95', 'opacity-0');
            DOM.compModalContent.classList.add('scale-100', 'opacity-100');
            
            // é‡ç½®æ¯”å¤§å°éŠæˆ²ä»‹é¢
            DOM.playerCard.textContent = '?';
            DOM.playerCard.className = 'card-display border-yellow-300 text-red-600';
            DOM.computerCard.textContent = '?';
            DOM.computerCard.className = 'card-display border-yellow-300 text-blue-600';
            DOM.comparisonResultText.textContent = 'é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œæ±ºå®šå‹è² ï¼';
            DOM.comparisonResultText.className = 'text-center text-xl font-bold p-3 rounded-lg bg-white text-gray-800 shadow-inner';
            DOM.startCompareButton.classList.remove('hidden');
            DOM.comparisonCloseButton.classList.add('hidden');
            
            // æš«åœä¸»éŠæˆ²æŠ½ç‰Œ
            DOM.drawButton.disabled = true;
        }

        /**
         * é–‹å§‹æ¯”å¤§å°éŠæˆ²ã€‚
         * Starts the comparison game.
         */
        window.startComparison = function() {
            DOM.startCompareButton.classList.add('hidden');

            const playerRankValue = Math.floor(Math.random() * 13) + 2; 
            const computerRankValue = Math.floor(Math.random() * 13) + 2; 

            const playerCardData = CARD_RANKS[playerRankValue];
            const computerCardData = CARD_RANKS[computerRankValue];

            DOM.playerCard.textContent = playerCardData.name;
            DOM.computerCard.textContent = computerCardData.name;
            
            let resultText = '';
            let winStatus = false;
            let resultClass = 'text-center text-2xl font-bold p-3 rounded-lg text-white ';

            if (playerRankValue > computerRankValue) {
                resultText = 'ğŸ† ç²å‹ï¼è«‹æº–å‚™åˆ®åˆ®æ¨‚ï¼';
                resultClass += 'bg-green-600';
                winStatus = true;
            } else if (playerRankValue < computerRankValue) {
                resultText = 'ğŸ˜¥ æŠ±æ­‰ï¼Œé›»è…¦çš„ç‰Œé¢æ›´å¤§ã€‚';
                resultClass += 'bg-red-600';
            } else {
                resultText = 'ğŸ¤ å¹³æ‰‹ï¼';
                resultClass += 'bg-yellow-600';
            }

            // æ›´æ–°é¡è‰²é¡¯ç¤º
            DOM.playerCard.classList.add(playerRankValue > computerRankValue ? 'text-red-600' : 'text-blue-600');
            DOM.computerCard.classList.add(computerRankValue > playerRankValue ? 'text-red-600' : 'text-blue-600');
            
            DOM.comparisonResultText.textContent = resultText;
            DOM.comparisonResultText.className = resultClass;
            
            // é‡ç½®é»æ•¸
            currentPoints = 0;

            // è™•ç†å¾ŒçºŒæµç¨‹
            setTimeout(() => {
                if (winStatus) {
                    DOM.comparisonModal.classList.add('hidden');
                    launchScratchModal(); // ç²å‹ï¼Œé€²å…¥åˆ®åˆ®æ¨‚
                } else {
                    DOM.comparisonCloseButton.classList.remove('hidden'); // å¤±æ•—ï¼Œç›´æ¥é—œé–‰
                }
            }, 1500);
        }
        
        // --- åˆ®åˆ®æ¨‚ Canvas äº’å‹•é‚è¼¯ ---
        
        /**
         * å•Ÿå‹•åˆ®åˆ®æ¨‚ Modal
         * Launches the scratch-off modal.
         */
        function launchScratchModal() {
            DOM.scratchModal.classList.remove('hidden');
            DOM.scratchCloseButton.classList.add('hidden');
            
            // æ±ºå®šåˆ®åˆ®æ¨‚çå‹µçµæœ
            prizeWon = determineScratchPrize();
            
            // è¨­å®šçå‹µæ–‡å­—é¡¯ç¤º (åœ¨ Canvas åº•ä¸‹)
            DOM.prizeDisplay.innerHTML = `
                <div class="space-y-2 text-center">
                    <p class="text-xl font-semibold text-gray-800">æ‚¨æŠ½åˆ°çš„çé …æ˜¯ï¼š</p>
                    <span class="text-5xl font-black ${prizeWon.isBigWin ? 'text-red-700' : 'text-green-700'}">${prizeWon.name}</span>
                </div>
            `;
            
            // åˆå§‹åŒ– Canvas
            setupScratchCanvas();
        }

        /**
         * æ±ºå®šåˆ®åˆ®æ¨‚çš„çé …
         * Determines the prize for the scratch-off ticket based on probability.
         */
        function determineScratchPrize() {
            const randomValue = Math.random() * 100;
            let cumulativeProb = 0;
            let result = SCRATCH_PRIZES[SCRATCH_PRIZES.length - 1]; 

            for (const prize of SCRATCH_PRIZES) {
                cumulativeProb += prize.prob;
                if (randomValue < cumulativeProb) {
                    result = prize;
                    break;
                }
            }
            return result;
        }

        /**
         * è¨­å®š Canvas å°ºå¯¸å’Œç¹ªè£½è¦†è“‹å±¤
         * Sets up the canvas size and draws the initial cover layer.
         */
        function setupScratchCanvas() {
            const canvas = DOM.scratchCanvas;
            
            // ç¢ºä¿ Canvas å°ºå¯¸é©æ‡‰å…¶å®¹å™¨
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            ctx = canvas.getContext('2d');
            
            // ç¹ªè£½åˆå§‹è¦†è“‹å±¤
            drawCover();
            
            // æ¸…é™¤ä¸Šæ¬¡çš„äº‹ä»¶ç›£è½å™¨ä¸¦é‡æ–°ç¶å®š
            canvas.onmousedown = handleScratchStart;
            canvas.ontouchstart = handleScratchStart;
            canvas.onmousemove = handleScratchMove;
            canvas.ontouchmove = handleScratchMove;
            canvas.onmouseup = handleScratchEnd;
            canvas.ontouchend = handleScratchEnd;
        }

        /**
         * ç¹ªè£½é‡‘å±¬ç°è‰²çš„è¦†è“‹å±¤
         * Draws the metallic gray cover layer.
         */
        function drawCover() {
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = '#C0C0C0'; // éŠ€ç°è‰²
            ctx.fillRect(0, 0, DOM.scratchCanvas.width, DOM.scratchCanvas.height);
            
            // åŠ ä¸Šæ–‡å­—æç¤º (éå¿…è¦ï¼Œä½†å¢åŠ è¶£å‘³æ€§)
            ctx.fillStyle = '#555555';
            ctx.font = '24px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('ç”¨æ»‘é¼ æˆ–æ‰‹æŒ‡åˆ®é–‹', DOM.scratchCanvas.width / 2, DOM.scratchCanvas.height / 2);
        }

        /**
         * è™•ç†åˆ®çš„å‹•ä½œ (æ¸…é™¤è¦†è“‹å±¤)
         * Handles the scratching action (clearing the cover layer).
         */
        function scratch(x, y) {
            ctx.globalCompositeOperation = 'destination-out'; // é—œéµï¼ä½¿ç­†è§¸æ¸…é™¤ç•«å¸ƒ
            ctx.lineWidth = 30; // åˆ®çš„åŠå¾‘
            ctx.lineJoin = ctx.lineCap = 'round';
            ctx.lineTo(x, y);
            ctx.stroke();
        }
        
        /**
         * å°‡é é¢åº§æ¨™è½‰æ›ç‚º Canvas åº§æ¨™
         * Converts page coordinates to canvas coordinates.
         */
        function getCanvasPos(event) {
            const rect = DOM.scratchCanvas.getBoundingClientRect();
            let clientX, clientY;

            if (event.touches) {
                clientX = event.touches[0].clientX;
                clientY = event.touches[0].clientY;
            } else {
                clientX = event.clientX;
                clientY = event.clientY;
            }

            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        /**
         * é–‹å§‹åˆ®
         * Starts the scratching process.
         */
        function handleScratchStart(event) {
            event.preventDefault();
            isScratching = true;
            const pos = getCanvasPos(event);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        }

        /**
         * æ­£åœ¨åˆ®
         * Continues the scratching process.
         */
        function handleScratchMove(event) {
            if (!isScratching) return;
            event.preventDefault();
            const pos = getCanvasPos(event);
            scratch(pos.x, pos.y);
            checkScratchComplete();
        }

        /**
         * çµæŸåˆ®
         * Ends the scratching process.
         */
        function handleScratchEnd(event) {
            if (!isScratching) return;
            event.preventDefault();
            isScratching = false;
            checkScratchComplete(true); // æœ€çµ‚æª¢æŸ¥
        }

        /**
         * æª¢æŸ¥åˆ®é–‹é€²åº¦
         * Checks the progress of the scratching.
         */
        function checkScratchComplete(force = false) {
            // æ¯éš”ä¸€æ®µæ™‚é–“æª¢æŸ¥ä¸€æ¬¡ï¼Œæˆ–æ˜¯å¼·åˆ¶æª¢æŸ¥
            if (!force && Math.random() > 0.1) return; 

            const totalPixels = DOM.scratchCanvas.width * DOM.scratchCanvas.height;
            const imageData = ctx.getImageData(0, 0, DOM.scratchCanvas.width, DOM.scratchCanvas.height);
            const pixels = imageData.data;
            let clearedPixels = 0;

            // æª¢æŸ¥é€æ˜åº¦ (ç¬¬å››å€‹é€šé“)
            for (let i = 3; i < pixels.length; i += 4) {
                if (pixels[i] === 0) { // å®Œå…¨é€æ˜
                    clearedPixels++;
                }
            }

            const percentCleared = clearedPixels / totalPixels;

            if (percentCleared >= SCRATCH_THRESHOLD) {
                // è‡ªå‹•æ¸…é™¤å‰©é¤˜éƒ¨åˆ†
                ctx.clearRect(0, 0, DOM.scratchCanvas.width, DOM.scratchCanvas.height);
                
                // ç§»é™¤äº‹ä»¶ç›£è½å™¨ï¼Œé˜²æ­¢ç¹¼çºŒåˆ®
                const canvas = DOM.scratchCanvas;
                canvas.onmousedown = canvas.ontouchstart = null;
                canvas.onmousemove = canvas.ontouchmove = null;
                canvas.onmouseup = canvas.ontouchend = null;
                
                // é¡¯ç¤ºé—œé–‰æŒ‰éˆ•
                DOM.scratchCloseButton.classList.remove('hidden');
                
                // æ ¹æ“šçå‹µæ±ºå®šæ˜¯å¦è·³å‡ºæ…¶ç¥ç•«é¢
                if (prizeWon.isBigWin) {
                    // å»¶é²è·³å‡ºæ…¶ç¥ç•«é¢
                    setTimeout(() => {
                        DOM.scratchModal.classList.add('hidden');
                        launchWinModal(prizeWon);
                    }, 500);
                }
            }
        }
        
        /**
         * é¡¯ç¤ºè±ªè¯ä¸­ç Modal
         * Displays the celebratory win modal.
         */
        function launchWinModal(prize) {
            DOM.winModal.classList.remove('hidden');
            DOM.winPrizeText.textContent = `æ‚¨ç²å¾—äº† ${prize.name}ï¼`;
            DOM.winAmount.textContent = prize.isBigWin ? `$${prize.amount}` : prize.name;
        }

        // é é¢è¼‰å…¥æ™‚å…ˆåŸ·è¡Œä¸€æ¬¡ï¼Œè¨­å®šåˆå§‹ç‹€æ…‹
        window.onload = function() {
            updatePointsDisplay(); 
        }

    </script>
</body>
</html>
